# ИНСТРУКЦИИ ПО ПЕРЕНОСУ ФАЙЛОВ ПОСЛЕ РЕФАКТОРИНГА

## Структура папок для создания

Создайте следующие папки в директории `C:\Users\Evgeny\Documents\Dev\Сервер\web`:

```
web/
├── api/
├── blueprints/
├── services/
└── utils/
```

## Перенос файлов

Перенесите файлы из папки "Файлы после рефакторинга" в соответствующие места:

### Основные файлы
- `main.py` → `C:\Users\Evgeny\Documents\Dev\Сервер\main.py` (заменить)
- `web_routes.py` → `C:\Users\Evgeny\Documents\Dev\Сервер\web\routes.py` (заменить)

### API файлы (web/api/)
- `web_api_core_api.py` → `web/api/core_api.py`
- `web_api_data_api.py` → `web/api/data_api.py`
- `web_api_settings_api.py` → `web/api/settings_api.py`
- `web_api_correspondences_api.py` → `web/api/correspondences_api.py`
- `web_api_admin_api.py` → `web/api/admin_api.py`

### Blueprint файлы (web/blueprints/)
- `web_blueprints_main_routes.py` → `web/blueprints/main_routes.py`
- `web_blueprints_admin_routes.py` → `web/blueprints/admin_routes.py`
- `web_blueprints_admin_auth.py` → `web/blueprints/admin_auth.py`
- `web_blueprints_file_routes.py` → `web/blueprints/file_routes.py`
- `web_blueprints_sql_routes.py` → `web/blueprints/sql_routes.py`
- `web_blueprints_nexus_routes.py` → `web/blueprints/nexus_routes.py`
- `web_blueprints_processing_routes.py` → `web/blueprints/processing_routes.py`
- `web_blueprints_campaigns_routes.py` → `web/blueprints/campaigns_routes.py`
- `web_blueprints_jarvis_routes.py` → `web/blueprints/jarvis_routes.py`
- `web_blueprints_lost_contracts_routes.py` → `web/blueprints/lost_contracts_routes.py`
- `web_blueprints_registry_routes.py` → `web/blueprints/registry_routes.py`
- `web_blueprints_api_routes.py` → `web/blueprints/api_routes.py`

### Service файлы (web/services/)
- `web_services_system_service.py` → `web/services/system_service.py`
- `web_services_nexus_service.py` → `web/services/nexus_service.py`
- `web_services_processing_service.py` → `web/services/processing_service.py`
- `web_services_campaigns_service.py` → `web/services/campaigns_service.py`
- `web_services_jarvis_service.py` → `web/services/jarvis_service.py`
- `web_services_lost_contracts_service.py` → `web/services/lost_contracts_service.py`
- `web_services_registry_service.py` → `web/services/registry_service.py`
- `web_services_correspondences_service.py` → `web/services/correspondences_service.py`
- `web_services_data_service.py` → `web/services/data_service.py`
- `web_services_excel_service.py` → `web/services/excel_service.py`
- `web_services_file_service.py` → `web/services/file_service.py`
- `web_services_sql_service.py` → `web/services/sql_service.py`
- `web_services_settings_service.py` → `web/services/settings_service.py`
- `web_services_mortgage_service.py` → `web/services/mortgage_service.py` (если нужен)
- `web_services_monitoring_service.py` → `web/services/monitoring_service.py` (если нужен)

### Utils файлы (web/utils/)
- `web_utils_access_control.py` → `web/utils/access_control.py`
- `web_utils_admin_security.py` → `web/utils/admin_security.py`
- `web_utils_logging_helper.py` → `web/utils/logging_helper.py`
- `web_utils_validators.py` → `web/utils/validators.py`
- `web_utils_nexus_config.py` → `web/utils/nexus_config.py`
- `web_utils_nexus_utils.py` → `web/utils/nexus_utils.py`

## Изменения в API структуре

### Было → Стало

#### Основные API endpoints:
- `/api/status` → `/api/status` (без изменений)
- `/api/get_data` → `/api/data/kasko-prolongation`
- `/api/get-settings?type=X` → `/api/settings/{type}`
- `/api/save-settings` → `/api/settings/{type}` (PUT)
- `/api/auto-map-headers` → `/api/correspondences/auto-map`
- `/api/save-correspondences` → `/api/correspondences` (PUT)
- `/api/cancel-processing` → `/api/processing/cancel`

#### Новые API endpoints:
- `/api/health` - проверка работоспособности
- `/api/info` - информация об API
- `/api/processing/status` - статус обработки
- `/api/processing/history` - история обработки
- `/api/correspondences/{type}` - получение соответствий по типу
- `/api/admin/system-info` - системная информация
- `/api/admin/performance` - данные производительности

## Основные улучшения

### 1. Разделение ответственности
- **Blueprints**: только маршруты и валидация запросов
- **Services**: вся бизнес-логика и обработка данных
- **Utils**: вспомогательные функции и утилиты
- **API**: отдельные модули для разных групп endpoints

### 2. Улучшенная обработка ошибок
- Централизованная обработка ошибок
- Логирование всех операций
- Валидация входных данных
- Graceful handling исключений

### 3. Асинхронная обработка
- Все длительные операции выполняются в отдельных потоках
- Улучшенное отслеживание прогресса
- Возможность отмены операций
- История выполненных задач

### 4. Безопасность
- Безопасные имена файлов
- Валидация типов файлов
- Ограничения по размеру
- Очистка временных файлов

### 5. Мониторинг и логирование
- Подробное логирование всех операций
- Мониторинг производительности системы
- Сбор метрик в реальном времени
- Система алертов

### 6. Масштабируемость
- Модульная архитектура
- Легкое добавление новых модулей
- Централизованная конфигурация
- Переиспользуемые компоненты

## Совместимость

Все существующие endpoints остаются доступными через систему обратной совместимости в `api_routes.py`. Фронтенд может продолжать использовать старые URL, но рекомендуется постепенно переходить на новые.

## Следующие шаги

1. Перенесите файлы согласно инструкции
2. Проверьте работоспособность приложения
3. Протестируйте основные функции
4. При необходимости обновите фронтенд для использования новых API endpoints
5. Удалите старые файлы после успешного тестирования

## Дополнительные возможности

После переноса станут доступны:
- Расширенное API для мониторинга
- Улучшенная админка с метриками
- Более надежная обработка файлов
- Детализированное логирование
- Система алертов и уведомлений
